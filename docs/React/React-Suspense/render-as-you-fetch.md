# Render as you Fetch

Rendering as you fetch means getting the data as soon as you have the information you need to get it.

Together with React.Suspense, we can use `useTransition` to make the experience smoother. Here's an example:

```javascript
const SUSPENSE_CONFIG = {timeoutMs: 4000, busyDelayMs: 1000, busyMinDurationMs: 600};

function Component() {
  const [startTransition, isPending] = React.useTransition(SUSPENSE_CONFIG)
  // etc...

  function handleClick() {
    // do something that triggers some interim state change we want to
    // happen before suspending starts
    startTransition(() => {
      // do something that triggers a suspending component to render
    })
  }

  // if needed, you can use the `isPending` boolean to display a loading spinner
  // or similar
}
```

The practice of rendering as you fetch is very similar to what we saw in [[data-fetching]], leveraging the resource factory method. In this case, we want to create a factory with use of useEffect when rendering our app component. 

Here's an example that uses resources caching as well:
```jsx
//This is the component that leverages the resource we create down in the App component
function PokemonInfo({pokemonResource}) {
  const pokemon = pokemonResource.read()
  return (
    <div>
      <div className="pokemon-info__img-wrapper">
        <img src={pokemon.image} alt={pokemon.name} />
      </div>
      <PokemonDataView pokemon={pokemon} />
    </div>
  )
}

const SUSPENSE_CONFIG = {
  timeoutMs: 4000,
  busyDelayMs: 300,
  busyMinDurationMs: 700,
}

// we set the cache to live in a context that will be consumed with [[useContext]]
// we also assign our resource factory to the context so that it can use 
// cached values within its usages
const PokemonCacheContext = React.createContext();
function PokemonCacheProvider({children}) {

  const cache = React.useRef({});

  // this callback will change every time we re-render this component producer
  const getPokemonResource = React.useCallback(name=>{
    let resource = cache.current[name];
    if (!resource) {
      resource = createPokemonResource(name);
      cache.current[name] = resource;
    }
    return resource
  }, [])

  return(
    <PokemonCacheContext.Provider value={getPokemonResource}>
      {children}
    </PokemonCacheContext.Provider>
    )

}

function createPokemonResource(pokemonName) {
  return createResource(fetchPokemon(pokemonName))
}

function App() {
  const [pokemonName, setPokemonName] = React.useState('')
  const [startTransition, isPending] = React.useTransition(SUSPENSE_CONFIG)
  const [pokemonResource, setPokemonResource] = React.useState(null)

  const getPokemonResource = React.useContext(PokemonCacheContext);

  React.useEffect(() => {
    if (!pokemonName) {
      setPokemonResource(null)
      return
    }
    startTransition(() => {
      setPokemonResource(getPokemonResource(pokemonName))
    })
  }, [getPokemonResource, pokemonName, startTransition])

  function handleSubmit(newPokemonName) {
    setPokemonName(newPokemonName)
  }

  function handleReset() {
    setPokemonName('')
  }

  return (
    <div className="pokemon-info-app">
      <PokemonForm pokemonName={pokemonName} onSubmit={handleSubmit} />
      <hr />
      <div className={`pokemon-info ${isPending ? 'pokemon-loading' : ''}`}>
        {pokemonResource ? (
          <PokemonErrorBoundary
            onReset={handleReset}
            resetKeys={[pokemonResource]}
          >
          {/* remember that Suspense doesn't render until a value is returned.
          In this case, we're throwing whenever the status is idle or error 
          and return a positive response only when the status is "success" */}
            <React.Suspense
              fallback={<PokemonInfoFallback name={pokemonName} />}
            >
              <PokemonInfo pokemonResource={pokemonResource} />
            </React.Suspense>
          </PokemonErrorBoundary>
        ) : (
          'Submit a pokemon'
        )}
      </div>
    </div>
  )
}


function AppWithProvider() {
  return (
    <PokemonCacheProvider>
      <App/>
    </PokemonCacheProvider>
  )
}

```

[//begin]: # "Autogenerated link references for markdown compatibility"
[data-fetching]: data-fetching.md "Simple Data Fetching"
[//end]: # "Autogenerated link references"